<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Watson + OneAgentSDK</title>
  <style>
    /* Optionnel : taille du chat Watson */
    #root {
      width: 400px;
      height: 600px;
      border: 1px solid #ccc;
      margin: 20px auto;
    }
  </style>
</head>
<body>
  <h2>Chat Watson + OneAgentSDK</h2>
  <div id="root"></div>

  <!-- 1️⃣ Charger OneAgentSDK -->
  <script src="https://sfrrec00-sfrvalid.sfrtestglobalcc.com/OneAgentWeb/js/agentsdk/oneagentSDK.js"></script>

  <script>
    // 2️⃣ Configurer Watson Orchestrate
    window.wxOConfiguration = {
      orchestrationID: "20251027-1052-3045-40d2-fad754838d75_20251027-1052-5828-7030-9384ea78f531",
      hostURL: "https://dl.watson-orchestrate.ibm.com",
      rootElementID: "root",
      chatOptions: {
        agentId: "b59963bd-57ab-476e-8004-58973fc13835"
      }
    };

    // Charger le loader Watson après le DOM
    setTimeout(() => {
      const script = document.createElement('script');
      script.src = `${window.wxOConfiguration.hostURL}/wxochat/wxoLoader.js?embed=true`;
      script.addEventListener('load', () => {
        wxoLoader.init();
        console.log("Watson chat ready!");
      });
      document.head.appendChild(script);
    }, 0);

    // 3️⃣ Intercepter les messages OneAgentSDK
    OneAgentSDK.init();

    OneAgentSDK.addEventListener('onCallMessageReceived', async function(event) {
      const userMessage = event.detail.message;
      console.log("Message intercepté du OneAgent:", userMessage);

      // 4️⃣ Envoyer le message à Watson via l'embed
      if (window.wxoLoader && window.wxoLoader.bot) {
        wxoLoader.bot.addMessage(userMessage);
        console.log("Message envoyé à Watson:", userMessage);
      } else {
        console.warn("Watson chat non prêt, message en attente...");
      }
    });
  </script>
</body>
</html>
