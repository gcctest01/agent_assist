<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Agent Chat</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #chatLog {
            border: 1px solid #ccc;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            margin-bottom: 10px;
        }
        input[type="text"] {
            width: 70%;
            padding: 5px;
        }
        button {
            padding: 5px 10px;
        }
        p {
            margin: 5px 0;
        }
    </style>
</head>
<body>

    <h2>Chat avec l'agent</h2>
    <div id="chatLog"></div>
    <input type="text" id="userMessage" placeholder="Tapez un message...">
    <button id="sendBtn">Envoyer</button>

    <script>
        document.addEventListener("DOMContentLoaded", () => {

            const sendBtn = document.getElementById("sendBtn");
            const userMessageInput = document.getElementById("userMessage");
            const chatLog = document.getElementById("chatLog");

            // Envoyer le message quand on clique sur le bouton
            sendBtn.addEventListener("click", async () => {
                const message = userMessageInput.value.trim();
                if (!message) return;

                appendMessage("Vous", message);
                userMessageInput.value = "";

                try {
                    const suggestions = await sendMessageToBackend(message, "1234"); // Remplacez 1234 par userId réel
                    appendMessage("Agent", suggestions.response || "Aucune réponse reçue");
                } catch (err) {
                    console.error("Erreur backend :", err);
                    appendMessage("Agent", "Erreur backend : message non envoyé");
                }
            });

            // Fonction pour afficher les messages
            function appendMessage(sender, text) {
                const p = document.createElement("p");
                p.innerHTML = `<strong>${sender}:</strong> ${text}`;
                chatLog.appendChild(p);
                chatLog.scrollTop = chatLog.scrollHeight;
            }
        });

        // Fonction pour envoyer le message au backend
        async function sendMessageToBackend(message, userId) {
            const payload = {
                message: message,
                userId: userId
            };

            const response = await fetch("https://watsson-agent.onrender.com/api/message", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`Backend returned ${response.status}`);
            }

            const data = await response.json();
            return data;
        }
    </script>
</body>
</html>
